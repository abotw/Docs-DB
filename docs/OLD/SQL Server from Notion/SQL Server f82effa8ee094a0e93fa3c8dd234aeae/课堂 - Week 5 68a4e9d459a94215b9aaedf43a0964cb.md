# 课堂 | - |Week 5

# review

![Xk 数据库关系图](%E8%AF%BE%E5%A0%82%20-%20Week%205%2068a4e9d459a94215b9aaedf43a0964cb/Untitled.png)

Xk 数据库关系图

- 多表连接查询
    - 交叉连接：cross join
    - 内连接：join … on …
    连接的表一定要有相同的列
        - 相等连接 → 自然连接
        - 比较连接（比较运算符）
        - 自连接
        表自身和自身进行连接 → 别名 alias → Course AS ‘C1’, Course AS ‘C2’
    - 外连接：left / right / full
- 多表连接查询 vs. 子查询
    - 多表连接查询 > 子查询
    - select lists 里面是否只来自一个表 → 是：子查询 / 不是：多表连接查询

# 管理数据表数据

## 管理数据

### `INSERT` - 插入

[SQL Insert](https://www.quackit.com/sql/tutorial/sql_insert.cfm)

- `INSERT (INTO) … VALUES (…)`
- `INSERT INTO … SELECT … UNION …`
- `SELECT … INTO …`

```sql
INSERT table_name
VALUES ('column_value1', 'column_value2', 'column_value3'...);
```

```sql
INSERT INTO Individual
VALUES ( 6, 'Benny', 'Hill', 'hillbenny' );
```

```sql
INSERT Department
VALUES ('21','人工智能系')
INSERT Department
VALUES ('22','电气控制系')
```

```sql
INSERT INTO Department
SELECT '23','英语系'
UNION
SELECT '24','公共管理系'
UNION
SELECT '25','航空'
```

---

- **报错：数据分割**

```sql
INSERT Department(DepartName, DepartNo)
VALUES ('21','人工智能系')
```

Msg 8152, Level 16, State 4, Line 1
String or binary data would be truncated.
The statement has been terminated.

![Untitled](%E8%AF%BE%E5%A0%82%20-%20Week%205%2068a4e9d459a94215b9aaedf43a0964cb/Untitled%201.png)

---

- 主键约束：主键值是唯一且不为空的
- 外键约束：从表中的值是主表中的

- **报错：外键约束**

```sql
INSERT StuCou
VALUES ('00000001', '021','1','报名', 'Null')
```

Msg 547, Level 16, State 0, Line 1
The INSERT statement conflicted with **the FOREIGN KEY（外键）** constraint "CouNo_FK". The conflict occurred in database "Xk", table "dbo.Course", column 'CouNo'.
The statement has been terminated.

- **FOREIGN KEY**：表 A 当中的列 1 是参照了表 B 当中的列 1
    - Course - CouNo - 主键
    - StuCou - CouNo - 外键：StuCou.CouNo $\in$ Course.CouNo

---

```sql
INSERT StuCou
VALUES ('00000001', '019','1','报名', 'Null')
INSERT StuCou
VALUES ('00000001', '019','2','报名', 'Null')
```

Msg 2627, Level 14, State 1, Line 1
Violation of PRIMARY KEY constraint 'PK_StuCou'. Cannot insert duplicate key in object 'dbo.StuCou'. The duplicate key value is (00000001, 019).
The statement has been terminated.

---

```sql
SELECT lists
INTO table_name
```

```sql
SELECT * 
INTO CourseWillNum
-- INTO 后面必须是不存在的表
FROM Course
WHERE WillNum >= 40;
--
INSERT INTO CourseWillNum
SELECT *
FROM Course
WHERE WillNum >= 30 and WillNum < 40
```

- `SELECT … INTO …`

### `UPDATE` - 更新

[SQL Update](https://www.quackit.com/sql/tutorial/sql_update.cfm)

```sql
UPDATE table_name
SET column_name = value
FROM table_name
WHERE ...
```

```sql
UPDATE Individual
SET UserName = 'funnyman'
WHERE IndividualId = 6;
```

---

```sql
-- 更新表
-- 更新列
UPDATE Course
SET SchoolTime = '周二晚'
FROM Course
WHERE CouName = '电子出版概论'
```

```sql
UPDATE Student
SET Pwd = '#*3456'
FROM Student join Class
ON Student.ClassNo = Class.ClassNo
WHERE ClassName = '01数据库'
```

---

```sql
UPDATE StuCou
SET WillOrder = '1'
FROM Course join StuCou
ON Course.CouNo = StuCou.CouNo
WHERE CouName = 'Linux操作系统'
```

```sql
UPDATE StuCou
SET WillOrder = '1'
FROM Course, StuCou
WHERE Course.CouNo = StuCou.CouNo and CouName = 'Linux操作系统'
```

---

```sql
-- 插入后要不要更新
-- 更新 003 课程的 WillNum 要加1
UPDATE Course
SET WillNum = WillNum + 1
FROM Course
WHERE CouNo = '003'
```

### `DELETE` - 删除

[SQL Delete](https://www.quackit.com/sql/tutorial/sql_delete.cfm)

```sql
DELETE
FROM Individual
WHERE IndividualId = 6;
```

```sql
DELETE StuCou
FROM StuCou
WHERE CouNo = '017' and StuNo = '00000005'
-- 删除后是否要更新信息
UPDATE Course
SET WillNum = WillNum - 1
FROM Course
WHERE CouNo = '017'
```

## `UNION` 合并查询结果